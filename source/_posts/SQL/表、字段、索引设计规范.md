---
title: 表、字段、索引设计规范
date: 2019-11-18 18:21:00
tags: [Mysql,workflow]
categories: Mysql
---

<!-- more -->

### 一.库表命名规范

1. 库名必须有固定的命名长度，12个字符以内 ,  表名、字段名20个字符以内，需见名知意
2. 表名字段名使用单数的英文单词，多个单词使用 _ 符号连接
3. 库名、表名、字段名禁使用MySQL保留字
4. 临时库、表名必须以`tmp`为前缀，并以日期为后缀

### 二.库、表、字段开发设计规范

1. 原则上禁用分区表
2. 拆分大字段和访问频率低的字段，分离冷热数据
3. 用Hash进行分表，表名后缀使进制数
4. 按日期时间分表需符合`YYYY[MM][DD][HH]`格式
5. 尽可能不使用`TEXT`、`BLOB`类型,尽量使用`varchar`类型，实在避免不了，请拆表
6. 用`DECIMAL`代替`FLOAT`和`DOUBLE`存储精确浮点数
7. 所有字段均定义为`NOT NULL`，默认值，整型为`0`、字符串为空字符'' ，字段需要建索引的必须用`NOT NULL`、` NULL`字段很难查询优化，`NULL`字段的索引需要额外空间
8. 大表使用`bigint unsigned` 作为自增列
9. 使用`timestamp`存储时间
10. 禁止在数据库中存储明文密码，把密码加密后存储
11. 尽量使用数值类型字段替代字符串类型
12. 不允许使用`ENUM`，`ENUM`字段加类型是`DDL`操作，使用`TINYINT`来代替`ENUM`类型
13. 尽量使用`varchar`存储字符串。`VARCHAR(M)`，`M`尽可能小，因为`VARCHAR`按实际的字符数申请内存时，如果大于255个，需要2bytes，小于 等于255个，需要1bytes。M表示字符数而不是字节数，比如`VARCHAR(1024)`，最大可存储1024个汉字，根据实际业务选择长度M



### 三.索引规范

#### 1. 索引的数量要控制:

1. 单张表中索引数量不超过8个

2. 单个索引中的字段数不超过4个

3. 对字符串优先考虑使用前缀索引，前缀索引长度不超过10个字符

#### 2. 主键准则

1. 表必须有主键

2. 不使用更新频繁的列作为主键

3. 尽量不选择字符串列作为主键

4. 不使用`UUID`、`MD5`、`HASH`这些作为主键(数值太离散了)

5. 默认使`非空的唯一键`作为主键

6. 建议选择自增或发号器

#### 3. 重要的SQL必须被索引，比如:

1. `UPDATE`、`DELETE`语句的`WHERE`条件列

2. `ORDER BY`、`GROUP BY`、`DISTINCT`的字段

#### 4. 多表JOIN的字段注意以下:

1. 区分度最大的字段放在前面

2. 优先考虑覆盖索引

3. 避免冗余和重复索引

4. 索引要综合评估数据密度和分布以及考虑查询和更新比例

#### 5. 索引禁忌

1. 不在低基数列上建立索引，例如“性别”

2. 不在索引列进行数学运算和函数运算

#### 6. 不使用外键

1. 外键用来保护参照完整性，可在业务端实现

2. 对父表和子表的操作会相互影响，降低可用性

3. 增加锁冲突的概率

4. 增加写入和更新的延迟

#### 7. 索引命名:非唯一索引必须以 idx_字段1_字段2命名，唯一所以必须以`uniq_字段1_字段2`命名，索引名称必须全部小写

#### 8. 索引字段的默认值不能为NULL，要改为其他的`default`或者空。NULL非常影响索引的查询效率

#### 9. 反复查看与表相关的SQL，符合最左前缀的特点建立索引。多条字段重复的语句，要修改语句条件字段的顺序，为其建立一条联合索引，减少 索引数量

#### 10. 能使用唯一索引就要使用唯一索引，提高查询效率

#### 11、研发要经常使用`explain`，如果发现索引选择性差，必须学会使用`hint`